<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Support Tickets - WiseNews</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .tickets-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
        }
        .ticket-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .ticket-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        .ticket-body {
            padding: 20px;
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 5px 10px;
            border-radius: 15px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .status-open {
            background: #17a2b8;
            color: white;
        }
        .status-pending {
            background: #ffc107;
            color: #212529;
        }
        .status-resolved {
            background: #28a745;
            color: white;
        }
        .status-closed {
            background: #6c757d;
            color: white;
        }
        .priority-high {
            color: #dc3545;
        }
        .priority-medium {
            color: #ffc107;
        }
        .priority-low {
            color: #28a745;
        }
        .priority-urgent {
            color: #dc3545;
            font-weight: bold;
        }
        .ticket-meta {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        .filter-tabs {
            margin-bottom: 30px;
        }
        .search-box {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container fade-in">
            <a class="navbar-brand" href="/">
                <i class="fas fa-newspaper me-2"></i>WiseNews
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/support">‚Üê Back to Support</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="tickets-header">
        <div class="container text-center">
            <h1 class="display-4 mb-4">
                <i class="fas fa-ticket-alt me-3"></i>My Support Tickets
            </h1>
            <p class="lead">Track your support requests and their status</p>
        </div>
    </section>

    <!-- Tickets Content -->
    <section class="py-5">
        <div class="container fade-in">
            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <ul class="nav nav-pills justify-content-center">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-filter="all">All Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-filter="open">Open</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-filter="pending">Pending</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-filter="resolved">Resolved</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-filter="closed">Closed</a>
                    </li>
                </ul>
            </div>

            <!-- Search Box -->
            <div class="search-box">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <input type="text" class="form-control stable-input" id="searchTickets" placeholder="Search tickets...">
                            <button class="btn btn-outline-secondary stable-btn" type="button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets List -->
            {% if tickets %}
                <div class="tickets-container">
                    {% for ticket in tickets %}
                    <div class="card ticket-card" data-status="{{ ticket.status }}" data-priority="{{ ticket.priority }}">
                        <div class="ticket-header">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h5 class="mb-1">
                                        <i class="fas fa-ticket-alt me-2"></i>
                                        #{{ ticket.id }} - {{ ticket.subject }}
                                    </h5>
                                    <div class="ticket-meta">
                                        <span class="me-3">
                                            <i class="fas fa-folder me-1"></i>{{ ticket.category.title() }}
                                        </span>
                                        <span class="me-3">
                                            <i class="fas fa-calendar me-1"></i>{{ ticket.created_at[:10] }}
                                        </span>
                                        <span class="priority-{{ ticket.priority }}">
                                            <i class="fas fa-flag me-1"></i>{{ ticket.priority.title() }} Priority
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-4 text-md-end">
                                    <span class="status-badge status-{{ ticket.status }}">
                                        {{ ticket.status.title() }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="ticket-body">
                            <p class="mb-3">{{ ticket.description[:200] }}{% if ticket.description|length > 200 %}...{% endif %}</p>
                            
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <small class="text-muted">
                                        Last updated: {{ ticket.updated_at[:10] }}
                                    </small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button class="btn btn-outline-primary btn-sm stable-btn" onclick="viewTicket({{ ticket.id }})">
                                        <i class="fas fa-eye me-1"></i>View Details
                                    </button>
                                    {% if ticket.status in ['open', 'pending'] %}
                                    <button class="btn btn-outline-secondary btn-sm ms-2 stable-btn" onclick="addComment({{ ticket.id }})">
                                        <i class="fas fa-comment me-1"></i>Add Comment
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h3>No Support Tickets</h3>
                    <p class="mb-4">You haven't created any support tickets yet.</p>
                    <a href="/support/contact" class="btn btn-primary stable-btn">
                        <i class="fas fa-plus me-2"></i>Create New Ticket
                    </a>
                </div>
            {% endif %}

            <!-- Quick Actions -->
            <div class="row mt-5">
                <div class="col-lg-12 text-center">
                    <div class="card stable-card">
                        <div class="card-body p-4">
                            <h4>Need More Help?</h4>
                            <p class="mb-4">Can't find what you're looking for? We're here to help!</p>
                            <div class="d-flex justify-content-center gap-3 flex-wrap">
                                <a href="/support/chat" class="btn btn-primary stable-btn">
                                    <i class="fas fa-comments me-2"></i>Start Live Chat
                                </a>
                                <a href="/support/contact" class="btn btn-outline-primary stable-btn">
                                    <i class="fas fa-envelope me-2"></i>New Ticket
                                </a>
                                <a href="/support/faq" class="btn btn-outline-secondary stable-btn">
                                    <i class="fas fa-question-circle me-2"></i>Browse FAQ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ticket Details Modal -->
    <div class="modal fade" id="ticketModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title stable-title">Ticket Details</h5>
                    <button type="button" class="btn-close stable-btn" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="ticketDetails">
                        <!-- Ticket details will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary stable-btn" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary stable-btn" id="addCommentBtn">Add Comment</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Filter functionality
        document.querySelectorAll('.nav-link[data-filter]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active tab
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.dataset.filter;
                filterTickets(filter);
            });
        });

        function filterTickets(status) {
            const tickets = document.querySelectorAll('.ticket-card');
            
            tickets.forEach(ticket => {
                if (status === 'all' || ticket.dataset.status === status) {
                    ticket.style.display = 'block';
                } else {
                    ticket.style.display = 'none';
                }
            });
        }

        // Search functionality
        document.getElementById('searchTickets').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const tickets = document.querySelectorAll('.ticket-card');
            
            tickets.forEach(ticket => {
                const text = ticket.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    ticket.style.display = 'block';
                } else {
                    ticket.style.display = 'none';
                }
            });
        });

        // View ticket details
        function viewTicket(ticketId) {
            // For now, just show an alert. In a real implementation,
            // you would fetch ticket details via AJAX
            const modal = new bootstrap.Modal(document.getElementById('ticketModal'));
            
            document.getElementById('ticketDetails').innerHTML = `
                <div class="text-center p-4">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p class="mt-2">Loading ticket details...</p>
                </div>
            `;
            
            modal.show();
            
            // Simulate loading ticket details
            setTimeout(() => {
                document.getElementById('ticketDetails').innerHTML = `
                    <h6>Ticket #${ticketId}</h6>
                    <p>Detailed ticket information would be displayed here, including:</p>
                    <ul>
                        <li>Full description</li>
                        <li>Conversation history</li>
                        <li>Attached files</li>
                        <li>Resolution details (if resolved)</li>
                    </ul>
                    <p class="text-muted">This is a placeholder. The actual implementation would fetch real ticket data.</p>
                `;
            }, 1000);
        }

        // Add comment
        function addComment(ticketId) {
            const comment = prompt(`Add a comment to ticket #${ticketId}:`);
            if (comment && comment.trim()) {
                // In a real implementation, you would send this via AJAX
                alert(`Comment added to ticket #${ticketId}: "${comment}"`);
            }
        }

        // Auto-refresh ticket status (every 30 seconds)
        setInterval(() => {
            // In a real implementation, you would check for status updates
            console.log('Checking for ticket status updates...');
        }, 30000);
    </script>
</body>
</html>
