<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Analytics - WiseNews</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .analytics-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .platform-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .platform-card:hover {
            transform: translateY(-5px);
        }
        
        .twitter-card { border-left: 5px solid #1da1f2; }
        .facebook-card { border-left: 5px solid #4267b2; }
        .linkedin-card { border-left: 5px solid #0077b5; }
        .instagram-card { border-left: 5px solid #e4405f; }
        
        .trend-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container fade-in">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-newspaper"></i> WiseNews
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('dashboard') }}">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="analytics-card">
                    <h1 class="mb-0">
                        <i class="fas fa-chart-line"></i> Social Media Analytics
                    </h1>
                    <p class="mb-0 opacity-75">Track your social media performance and engagement</p>
                </div>
            </div>
        </div>

        <!-- Time Period Selector -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card stable-card">
                    <div class="card-body stable-card-body">
                        <h5 class="card-title">
                            <i class="fas fa-calendar"></i> Analysis Period
                        </h5>
                        <form method="GET" class="d-flex gap-2" class="stable-form">
                            <select name="days" class="form-select stable-select" onchange="this.form.submit()">
                                <option value="7" {{ 'selected' if days == 7 }}>Last 7 days</option>
                                <option value="30" {{ 'selected' if days == 30 }}>Last 30 days</option>
                                <option value="90" {{ 'selected' if days == 90 }}>Last 90 days</option>
                                <option value="365" {{ 'selected' if days == 365 }}>Last year</option>
                            </select>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card stable-card">
                    <div class="card-body stable-card-body">
                        <h5 class="card-title">
                            <i class="fas fa-sync"></i> Last Updated
                        </h5>
                        <p class="card-text" id="lastUpdated">
                            <span class="badge bg-success">Live Data</span>
                            {{ current_time.strftime('%B %d, %Y, %I:%M:%S %p') if current_time else 'Current Time' }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Platform Performance Cards -->
        <div class="row mb-4">
            {% for platform, stats in analytics.platform_stats.items() %}
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card platform-card {{ platform }}-card h-100">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            {% if platform == 'twitter' %}
                                <i class="fab fa-twitter fa-3x text-primary"></i>
                            {% elif platform == 'facebook' %}
                                <i class="fab fa-facebook fa-3x text-primary"></i>
                            {% elif platform == 'linkedin' %}
                                <i class="fab fa-linkedin fa-3x text-primary"></i>
                            {% elif platform == 'instagram' %}
                                <i class="fab fa-instagram fa-3x text-primary"></i>
                            {% endif %}
                        </div>
                        <h5 class="card-title stable-title">{{ platform.title() }}</h5>
                        
                        <div class="row text-center">
                            <div class="col-12 mb-2">
                                <div class="metric-value">{{ stats.total_posts }}</div>
                                <small class="text-muted">Total Posts</small>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row text-center small">
                            <div class="col-4">
                                <div class="fw-bold">{{ "%.1f"|format(stats.avg_engagement.likes) }}</div>
                                <small class="text-muted">Avg Likes</small>
                            </div>
                            <div class="col-4">
                                <div class="fw-bold">{{ "%.1f"|format(stats.avg_engagement.shares) }}</div>
                                <small class="text-muted">Avg Shares</small>
                            </div>
                            <div class="col-4">
                                <div class="fw-bold">{{ "%.1f"|format(stats.avg_engagement.comments) }}</div>
                                <small class="text-muted">Avg Comments</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="chart-container">
                    <h5 class="mb-3">
                        <i class="fas fa-chart-area"></i> Engagement Over Time
                    </h5>
                    <canvas id="engagementChart" height="100"></canvas>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="chart-container">
                    <h5 class="mb-3">
                        <i class="fas fa-chart-pie"></i> Platform Distribution
                    </h5>
                    <canvas id="platformChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Top Posts and Trends -->
        <div class="row mb-4">
            <!-- Top Performing Posts -->
            <div class="col-lg-6">
                <div class="card stable-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-trophy"></i> Top Performing Posts
                        </h5>
                    </div>
                    <div class="card-body stable-card-body">
                        {% for post in analytics.top_posts[:5] %}
                        <div class="d-flex align-items-start mb-3 p-3 bg-light rounded">
                            <div class="flex-shrink-0 me-3">
                                {% if post.platform == 'twitter' %}
                                    <i class="fab fa-twitter text-info"></i>
                                {% elif post.platform == 'facebook' %}
                                    <i class="fab fa-facebook text-primary"></i>
                                {% elif post.platform == 'linkedin' %}
                                    <i class="fab fa-linkedin text-primary"></i>
                                {% elif post.platform == 'instagram' %}
                                    <i class="fab fa-instagram text-danger"></i>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <p class="mb-1 small">
                                    {{ post.content.get('text', post.content.get('message', 'Social media post'))[:100] }}...
                                </p>
                                <div class="d-flex gap-3 small text-muted">
                                    <span>
                                        <i class="fas fa-heart"></i> {{ post.engagement.get('likes', 0) }}
                                    </span>
                                    <span>
                                        <i class="fas fa-share"></i> {{ post.engagement.get('shares', post.engagement.get('retweets', 0)) }}
                                    </span>
                                    <span>
                                        <i class="fas fa-comment"></i> {{ post.engagement.get('comments', post.engagement.get('replies', 0)) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        {% if not analytics.top_posts %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <p>No posts found for the selected period</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Social Media Trends -->
            <div class="col-lg-6">
                <div class="card stable-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-trending-up"></i> Trending Topics
                        </h5>
                    </div>
                    <div class="card-body stable-card-body">
                        {% for trend in trends[:10] %}
                        <div class="trend-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ trend.trend_name }}</strong>
                                    <div class="small text-muted">
                                        <i class="fab fa-{{ trend.platform }}"></i>
                                        {{ trend.platform.title() }} â€¢ {{ trend.trend_category.title() }}
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="fw-bold text-success">{{ "{:,}".format(trend.trend_volume) }}</div>
                                    <div class="small text-muted">mentions</div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="progress" style="height: 5px;">
                                    <div class="progress-bar bg-success" 
                                         style="width: {{ trend.relevance_score * 100 }}%">
                                    </div>
                                </div>
                                <div class="small text-muted mt-1">
                                    Relevance: {{ "%.0f"|format(trend.relevance_score * 100) }}%
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        {% if not trends %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <p>No trends data available</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card stable-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-rocket"></i> Quick Actions
                        </h5>
                    </div>
                    <div class="card-body stable-card-body">
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-primary w-100 stable-btn" onclick="schedulePost()">
                                    <i class="fas fa-clock"></i> Schedule Post
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-success w-100 stable-btn" onclick="shareBreakingNews()">
                                    <i class="fas fa-bullhorn"></i> Share Breaking News
                                </button>
                            </div>
                            <div class="col-md-3 mb-2">
                                <a href="{{ url_for('social.social_settings') }}" class="btn btn-info w-100 stable-btn">
                                    <i class="fas fa-cog"></i> Manage Accounts
                                </a>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-warning w-100 stable-btn" onclick="exportAnalytics()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize charts
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateTimestamp();
        });

        function initializeCharts() {
            // Engagement Over Time Chart
            const engagementCtx = document.getElementById('engagementChart').getContext('2d');
            new Chart(engagementCtx, {
                type: 'line',
                data: {
                    labels: generateDateLabels({{ days }}),
                    datasets: [
                        {
                            label: 'Likes',
                            data: generateMockData({{ days }}),
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Shares',
                            data: generateMockData({{ days }}),
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Comments',
                            data: generateMockData({{ days }}),
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Platform Distribution Chart
            const platformCtx = document.getElementById('platformChart').getContext('2d');
            const platformData = {
                labels: Object.keys({{ analytics.platform_stats | tojson }}),
                datasets: [{
                    data: Object.values({{ analytics.platform_stats | tojson }}).map(stats => stats.total_posts),
                    backgroundColor: [
                        '#1da1f2', // Twitter
                        '#4267b2', // Facebook
                        '#0077b5', // LinkedIn
                        '#e4405f'  // Instagram
                    ]
                }]
            };

            new Chart(platformCtx, {
                type: 'doughnut',
                data: platformData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function generateDateLabels(days) {
            const labels = [];
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString());
            }
            return labels;
        }

        function generateMockData(days) {
            return Array.from({length: days}, () => Math.floor(Math.random() * 100));
        }

        function updateTimestamp() {
            document.getElementById('lastUpdated').innerHTML = 
                '<span class="badge bg-success">Live Data</span> ' + 
                new Date().toLocaleString();
        }

        function schedulePost() {
            // Modal or redirect to scheduling interface
            alert('Scheduling interface would open here');
        }

        function shareBreakingNews() {
            // Quick share interface
            alert('Quick share interface would open here');
        }

        function exportAnalytics() {
            // Export functionality
            window.location.href = `/social/api/analytics?days={{ days }}&format=csv`;
        }

        // Auto-refresh every 5 minutes
        setInterval(() => {
            updateTimestamp();
            // Could also refresh data here
        }, 300000);
    </script>
</body>
</html>
